#!/usr/bin/env bash

if [ -z "$1" ]; then
    echo "Usage: $0 <ino file>" >&2
    echo >&2
    echo "To remove build files, run" >&2
    echo "  $0 --clean" >&2
    exit 1
fi

if [ "$1" == --clean ]; then
    make -C emu clean
    exit $?
fi

if [ ! -f "$1" ]; then
    echo "ERROR: no such file '$1'" >&2
    exit 1
fi

rsync "$1" emu/ino.cpp -u || exit 1
rsync -a src emu/ -u || exit 1
make -C emu || exit 1

emu/ino || exit 1
